snes_uh = zeros(21, 20);

snes_uh(:,1) = [0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                -0.54402111088937;
                ];

snes_uh(:, 2) = [0.0469949278790754;
                 0.57501104145373;
                 1.08057529775141;
                 1.3479061750176;
                 1.19767401011823;
                 0.715239713568341;
                 0.167463772260764;
                 -0.353022301177344;
                 -0.875284309963495;
                 -1.2541969406547;
                 -1.24263291106098;
                 -0.819175896179746;
                 -0.270823780105879;
                 0.234746862947046;
                 0.749431277873764;
                 1.20386942379745;
                 1.31813268224586;
                 0.96681092762493;
                 0.419903037643202;
                 -0.0847367177318517;
                 -0.54402111088937;
                ];
snes_uh(:, 3) = [0.0563692519706301;
                0.59439918558514;
                0.909546633867779;
                0.927057011622213;
                0.937738144242128;
                0.711611197919666;
                0.18885864586435;
                -0.371743605614593;
                -0.805320638297031;
                -0.92448747558151;
                -0.934051316124842;
                -0.776929865832063;
                -0.289969577781414;
                0.257595255294098;
                0.731895353663496;
                0.933667186856945;
                0.943723751266362;
                0.868855176947681;
                0.44987310276374;
                -0.0924721417198069;
                -0.54402111088937;
                ];

snes_uh(:, 4) = [0.0570140869732605;
                0.509272127321972;
                0.774585057829312;
                0.919437488557945;
                0.832706183514683;
                0.592091088365751;
                0.171047914572408;
                -0.322398213712049;
                -0.658633457923558;
                -0.848230045368472;
                -0.839914903043684;
                -0.626753930114223;
                -0.243548021914867;
                0.239045164436875;
                0.611252417255368;
                0.83522242633528;
                0.898255175805313;
                0.714258677074115;
                0.390810382344431;
                -0.0815713846291429;
                -0.54402111088937;
                ];

snes_uh(:, 5) = [0.0535382664084183;
                0.516279374224837;
                0.862111237129242;
                1.01931205832913;
                0.935813025854209;
                0.617147316075725;
                0.168599348254581;
                -0.326476731480904;
                -0.717989682623251;
                -0.963091261948607;
                -0.958016194264162;
                -0.679661408243389;
                -0.248381346245566;
                0.234865118164963;
                0.63900306669614;
                0.937608764464373;
                1.0051054655885;
                0.787092779589991;
                0.39108334343681;
                -0.0812539195200211;
                -0.54402111088937;
                ];

snes_uh(:, 6) = [0.0539262274036436;
                0.540034318378022;
                0.884132798072367;
                1.02919868012854;
                0.949229448691262;
                0.647293982511527;
                0.173250548783563;
                -0.339647007709947;
                -0.748781177621457;
                -0.969899738257096;
                -0.965611537634853;
                -0.712116494947153;
                -0.25995834729565;
                0.240815513515387;
                0.670212083310564;
                0.951491891041606;
                1.01458968512533;
                0.816345363345116;
                0.407344449593176;
                -0.0842382832480565;
                -0.54402111088937;
                ];

snes_uh(:, 7) = [0.054427379894398;
                0.538616894179855;
                0.870629581662897;
                1.00357629652982;
                0.934457326960432;
                0.642584573873647;
                0.173644649383997;
                -0.339180359073725;
                -0.738251238043159;
                -0.954018924406831;
                -0.950423453327583;
                -0.702798329028644;
                -0.259064757851785;
                0.241771773516405;
                0.664445067769426;
                0.935950524588132;
                0.993595612484602;
                0.804738984925043;
                0.40746106755959;
                -0.0843403185132485;
                -0.54402111088937;
                ];
snes_uh(:, 8) = [0.0543768011496795;
                0.535141466396475;
                0.868608228507486;
                1.00844100227147;
                0.932575520799562;
                0.638679923308806;
                0.172986129580912;
                -0.33710817513506;
                -0.735127101511355;
                -0.952075846796512;
                -0.9481564186386;
                -0.699432350657903;
                -0.257488554882823;
                0.240658838225915;
                0.660428890285817;
                0.934174486671331;
                0.994736459680261;
                0.801851375209516;
                0.404901056199202;
                -0.0838649116759441;
                -0.54402111088937;
                ];
snes_uh(:, 9) = [0.0542333554625241;
                0.53486259264701;
                0.870013065671536;
                1.01032639333021;
                0.935291929666157;
                0.638749133757536;
                0.172724431240321;
                -0.336966677167411;
                -0.73605319528117;
                -0.956350977969968;
                -0.952013281783046;
                -0.699979438891413;
                -0.257321492631341;
                0.240418262676972;
                0.660876835565034;
                0.937288176241598;
                0.998276063304722;
                0.802730183300217;
                0.404529604748557;
                -0.0837795625554607;
                -0.54402111088937;
                ];
snes_uh(:, 10) = [0.0542659433754601;
                0.535335086610127;
                0.870408682992267;
                1.01056205304969;
                0.935147971829806;
                0.639251270911212;
                0.172861970848023;
                -0.33722242991323;
                -0.73637192634757;
                -0.955323974241003;
                -0.951356264339057;
                -0.700449732410632;
                -0.257565528624456;
                0.240557706848114;
                0.661219689311049;
                0.936828985275481;
                0.997477000457184;
                0.803217179285434;
                0.404892835362401;
                -0.0838498068909249;
                -0.54402111088937;
                ];
snes_uh(:, 11) = [0.0542849384054351;
                0.535392163312558;
                0.870116061890507;
                1.00995941795522;
                0.934774035056571;
                0.63929025275604;
                0.172897738618612;
                -0.337250874463961;
                -0.736344567790103;
                -0.955166100197403
                -0.95099513048207;
                -0.700432880713225;
                -0.257588800904549;
                0.240600238376436;
                0.661268325492765;
                0.936617395370381;
                0.997396355535378;
                0.803097198767275;
                0.40494985806268;
                -0.0838620328105092;
                -0.54402111088937;
                ];
snes_uh(:, 12) = [0.0542785651210708;
                0.535360489057029;
                0.87017807828451;
                1.01014211855628;
                0.934891768247982;
                0.639251033809236;
                0.172882147378319;
                -0.337237930004051;
                -0.736311404871212;
                -0.955163604870667;
                -0.951118204784772;
                -0.700397083793347;
                -0.257574833724794;
                0.240585954419171;
                0.66122953307278;
                0.936645915507894;
                0.997287932715447;
                0.803085909163619;
                0.404925179530333;
                -0.0838570566699716;
                -0.54402111088937;
                ];
snes_uh(:, 13) = [0.0542779798390512;
                0.535359848839003;
                0.870215255475082;
                1.0101853361149;
                0.934910639072838;
                0.639255761732634;
                0.172882300288097;
                -0.337235903203391;
                -0.736324288926195;
                -0.955198989137227;
                -0.951121511954156;
                -0.700409721501633;
                -0.257574419003645;
                0.240584003631156;
                0.661229252803514;
                0.936674339781944;
                0.997393037810981;
                0.803115331438382;
                0.404922926491906;
                -0.0838565671090937;
                -0.54402111088937;
                ];
snes_uh(:, 14) = [0.0542777913990277;
                0.535359401789554;
                0.870201196156765;
                1.01016290676811;
                0.934902103138999;
                0.639254342225766;
                0.172881773210867;
                -0.337236242820185;
                -0.736321353183224;
                -0.955183098148178;
                -0.951120687300934;
                -0.700407272424023;
                -0.257574703037416;
                0.240583676942751;
                0.661229002352556;
                0.936662876388423;
                0.997342344320956;
                0.803106767477192;
                0.40492299808821;
                -0.0838565693512077;
                -0.54402111088937;
                ];
snes_uh(:, 15) = [0.0542778846548612;
                0.535359606532361;
                0.870196928920587;
                1.01016302199726;
                0.934900829510792;
                0.639253761104149;
                0.172881639210937;
                -0.337236317812158;
                -0.736319205634367;
                -0.955180744074262;
                -0.951119870600585;
                -0.700405007589485;
                -0.257574505224449;
                0.240583904724242;
                0.661229346835609;
                0.936659976317864;
                0.997338589450481;
                0.80310215953936;
                0.40492313700484;
                -0.0838565879802183;
                -0.54402111088937;
                ];
snes_uh(:, 16) = [0.0542778202901436;
                0.535359553667397;
                0.8701987806127;
                1.01016275488243;
                0.934901465320173;
                0.639253923010686;
                0.172881656735861;
                -0.337236319497212;
                -0.736319907619272;
                -0.955181961434397;
                -0.951120296052236;
                -0.700405708989115;
                -0.257574571643638;
                0.240583819697856;
                0.661229196980496;
                0.936661368197944;
                0.997340430345694;
                0.803103875961185;
                0.404923114774853;
                -0.083856584434617;
                -0.54402111088937;
                ];
snes_uh(:, 17) = [0.0542778215909533;
                0.535359546924851;
                0.870198935604665;
                1.01016311478205;
                0.934901464768957;
                0.639253984196928;
                0.172881672061062;
                -0.337236309804022;
                -0.736320081547773;
                -0.955181894040989;
                -0.95112025399429;
                -0.700405913621917;
                -0.257574595357339;
                0.240583794781051;
                0.661229171899858;
                0.936661343851367;
                0.997340540180678;
                0.803104186766452;
                0.404923106810591;
                -0.0838565837192523;
                -0.54402111088937;
                ];
snes_uh(:, 18) = [0.0542778239931238;
                0.53535954965585;
                0.870198834733726;
                1.01016292570788;
                0.934901456408701;
                0.639253964741457;
                0.172881668839739;
                -0.337236310466288;
                -0.736320011165694;
                -0.95518191593627;
                -0.951120263810532;
                -0.700405832515614;
                -0.257574583939096;
                0.240583807005233;
                0.661229190262492;
                0.936661341755455;
                0.997340487222528;
                0.803104037372139;
                0.404923108864651;
                -0.0838565839888964;
                -0.54402111088937;
                ];
snes_uh(:, 19) = [0.0542778227771728;
                0.535359548976509;
                0.87019884858379;
                1.01016294709747;
                0.934901460509709;
                0.63925395936447;
                0.172881667252492;
                -0.337236311849427;
                -0.73632000378447;
                -0.955181920657711;
                -0.951120271775162;
                -0.700405822958408;
                -0.257574583382463;
                0.240583807405931;
                0.661229188059392;
                0.936661348762567;
                0.997340479262405;
                0.803104033994905;
                0.404923109177908;
                -0.0838565840003776;
                -0.54402111088937;
                ];
snes_uh(:, 20) = [0.0542778231421184;
                0.535359549262439;
                0.870198843507552;
                1.0101629383169;
                0.93490145840676;
                0.639253961083469;
                0.17288166771948;
                -0.337236311478711;
                -0.736320006490734;
                -0.955181916648556;
                -0.951120267211544;
                -0.700405826602027;
                -0.257574583767563;
                0.240583807052877;
                0.661229188184279;
                0.936661343997165;
                0.997340482900556;
                0.803104036614119;
                0.404923109106831;
                -0.0838565839938656;
                -0.54402111088937;
                ];

% plot the solution
figure;
X_h = omega_l: hh/pp :omega_r;
for i=1:counter
    Y_h = snes_uh(:,i);
    h_fem = plot(X_h, Y_h,'b-', 'LineWidth', 2);
    hold on;
end
X = omega_l:0.01:omega_r;
Y = exact(X);
h_exact = plot(X, Y,'r--', 'LineWidth', 2);

legend([h_fem, h_exact], {'FEM', 'EXACT'}, 'Location', 'Best', 'FontSize', 14, 'Box', 'on');
xlabel("X");
ylabel("Temperature");


snes_error = zeros(20, 1);

snes_error(1,:) = 2.900846405359e+00;
snes_error(2,:) = 3.371646644088e+00;
snes_error(3,:) = 2.070487387799e+00;
snes_error(4,:) = 7.612242717596e-01;
snes_error(5,:) = 4.354529841201e-01;
snes_error(6,:) = 1.178548996397e-01;
snes_error(7,:) = 1.053908665063e-01;
snes_error(8,:) = 2.617566392502e-02;
snes_error(9,:) = 1.922227661037e-02;
snes_error(10,:) = 3.446043268960e-03;
snes_error(11,:) = 2.608352454811e-03;
snes_error(12,:) = 4.593379359702e-04;
snes_error(13,:) = 5.133995079536e-04;
snes_error(14,:) = 3.880995977850e-05;
snes_error(15,:) = 2.950649880531e-05;
snes_error(16,:) = 3.198461792628e-06;
snes_error(17,:) = 2.531745007343e-06;
snes_error(18,:) = 1.680448839022e-07;
snes_error(19,:) = 1.372579468341e-07;
snes_error(20,:) = 9.919886357820e-09;

log_error = log(error_set);
figure;
plot(log_error(1:counter-1), log_error(2:counter),'b-', 'LineWidth', 2);

snes_log_error = log(snes_error);
hold on;
plot(snes_log_error(1:counter-1), snes_log_error(2:counter),'r--', 'LineWidth', 2);
xlabel("ln(r_{i})");
ylabel("ln(r_{i+1})");

legend('Matlab','PetscSNES','Location', 'Best', 'FontSize', 14, 'Box', 'on');

uh_error = snes_uh(:, 1:counter) - uh_set(:, 1:counter); 

uh_error_norm = zeros(counter, 1);
for i = 1:counter
    uh_error_norm(i) = norm(uh_error(:,i));
end

