snes_uh = zeros(21, 17);

snes_uh(:,1) = [0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                -0.54402111088937;
                ];

snes_uh(:, 2) = [0.0469949278790754;
                0.57501104145373;
                1.08057529775141;
                1.3479061750176;
                1.19767401011823;
                0.715239713568341;
                0.167463772260764;
                -0.353022301177344;
                -0.875284309963495;
                -1.2541969406547;
                -1.24263291106098;
                -0.819175896179746;
                -0.270823780105879;
                0.234746862947046;
                0.749431277873764;
                1.20386942379745;
                1.31813268224586;
                0.96681092762493;
                0.419903037643202;
                -0.0847367177318517;
                -0.54402111088937;
                ];
snes_uh(:, 3) = [0.0505518947592817;
                0.547389012044877;
                0.873811119258082;
                0.935099299154743;
                0.915974886819972;
                0.660171955639917;
                0.171174238945708;
                -0.341153277104583;
                -0.758986115954306;
                -0.916279170450222;
                -0.921332092902611;
                -0.727674319550038;
                -0.265288976417651;
                0.234616795851344;
                0.68147965686675;
                0.914053671168355;
                0.942169607578825;
                0.822918468428179;
                0.411534363168179;
                -0.0843074669888154;
                -0.54402111088937;
                ];

snes_uh(:, 4) = [0.0533027762302965;
                0.540573584226781;
                0.871712012924333;
                1.01338128750709;
                0.935180280743647;
                0.645311557563841;
                0.172065453244921;
                -0.338653163995693;
                -0.740561269927874;
                -0.954558208413749;
                -0.949697074968322;
                -0.704735517881949;
                -0.259228929477827;
                0.239236330162205;
                0.66791884207797;
                0.937231890994501;
                0.998913371017027;
                0.805551631882861;
                0.407727738661227;
                -0.0840772393200715;
                -0.54402111088937;
                ];

snes_uh(:, 5) = [0.0544283181543753;
                0.534312779322646;
                0.86947653081645;
                1.0071324343744;
                0.93509110526362;
                0.637093030807785;
                0.172955935212864;
                -0.336963865775125;
                -0.733912392826931;
                -0.955718432713378;
                -0.952237921825942;
                -0.697932869897188;
                -0.257054962395862;
                0.240807408223996;
                0.658572050438972;
                0.936532702703451;
                0.995934066310553;
                0.801651339747582;
                0.404612451552421;
                -0.0838572913063917;
                -0.54402111088937;
                ];

snes_uh(:, 6) = [0.054346996615867;
                0.535052300792898;
                0.870178220704911;
                1.01069127347397;
                0.934862511817953;
                0.638813077861272;
                0.172960036319077;
                -0.337121227766711;
                -0.735995827489927;
                -0.95509053211332;
                -0.951028428897789;
                -0.700082094874894;
                -0.257459347063654;
                0.240631318813468;
                0.660672897102304;
                0.936572348705413;
                0.997499138818163;
                0.802993527440075;
                0.404810535054569;
                -0.0838560458548099;
                -0.54402111088937;
                ];

snes_uh(:, 7) = [0.0542970652360592;
                0.535255374559538;
                0.870178302598062;
                1.01004221234743;
                0.93488542846742;
                0.639150999374891;
                0.17291079725358;
                -0.33720024139695;
                -0.736285665434371;
                -0.955193221470065;
                -0.951135443803384;
                -0.700368393011046;
                -0.257544103803666;
                0.240597828881554;
                0.661117656071682;
                0.936658794644436;
                0.997312855938372;
                0.803095721173852;
                0.404882357563767;
                -0.0838560712929801;
                -0.54402111088937;
                ];
snes_uh(:, 8) = [0.0542838747823033;
                0.535330047926215;
                0.870194903461471;
                1.01018713966558;
                0.934898043646782;
                0.639233072621481;
                0.172891375677284;
                -0.337225530325462;
                -0.736318697511488;
                -0.955181221286957;
                -0.951119944827266;
                -0.700404370170677;
                -0.257566273124044;
                0.240588330606265;
                0.661211764934076;
                0.936658980147914;
                0.997345602789934;
                0.80310306873817;
                0.404909647457849;
                -0.083856281734764;
                -0.54402111088937;
                ];
snes_uh(:, 9) = [0.0542795062536962;
                0.535350847348832;
                0.870197311187508;
                1.01015514146011;
                0.934900243497161;
                0.639249151440256;
                0.172884639484692;
                -0.337233263725553;
                -0.736320535152757;
                -0.955182650433835;
                -0.951120948630411;
                -0.700406301157623;
                -0.257572080676489;
                0.240585298468936;
                0.661226362456666;
                0.936661320285324;
                0.997339291827875;
                0.803103807639584;
                0.404918636171121;
                -0.0838564349406604;
                -0.54402111088937;
                ];
snes_uh(:, 10) = [0.0542783631239439;
                0.535357268460276;
                0.870198562654504;
                1.01016465842815;
                0.934901217212616;
                0.639252907699784;
                0.172882551715835;
                -0.337235486971105;
                -0.736320200530694;
                -0.955181951019451;
                -0.951120320538516;
                -0.700406027694929;
                -0.257573825213152;
                0.240584283949088;
                0.661228773032811;
                0.936661237093392;
                0.997340713517199;
                0.803103947644628;
                0.404921697519614;
                -0.0838565186643921;
                -0.54402111088937;
                ];
snes_uh(:, 11) = [0.0542779921962458;
                0.535358912011869;
                0.870198739410436;
                1.01016235546024;
                0.934901376872243;
                0.639253697389742;
                0.172881936824738;
                -0.337236089598222;
                -0.736320071386354;
                -0.955181965790796;
                -0.951120309534707;
                -0.700405891247485;
                -0.257574343063366;
                0.24058396073639;
                0.661229111656026;
                0.936661340539623;
                0.997340414098253;
                0.803104009179163;
                0.404922650149894;
                -0.0838565564558463;
                -0.54402111088937;
                ];
snes_uh(:, 12) = [0.0542778798709786;
                0.535359386279788;
                0.870198822484794;
                1.01016307465276;
                0.934901439998378;
                0.639253897010848;
                0.172881747221851;
                -0.337236256647398;
                -0.736320024855625;
                -0.955181923572014;
                -0.951120275016432;
                -0.700405845492471;
                -0.257574510135843;
                0.240583854228552;
                0.661229173030084;
                0.936661337094768;
                0.997340493656409;
                0.803104026750192;
                0.40492296626039;
                -0.0838565731353597;
                -0.54402111088937;
                ];
snes_uh(:, 13) = [0.0542778416097074;
                0.53535950367136;
                0.870198835106919;
                1.01016289102179;
                0.934901452223286;
                0.639253943572969;
                0.172881691906453;
                -0.337236298663693;
                -0.736320012781965;
                -0.955181921428224;
                -0.951120271128749;
                -0.700405832933679;
                -0.257574560674018;
                0.240583821682968;
                0.661229184185181;
                0.936661343754779;
                0.997340478355616;
                0.803104033344952;
                0.404923062981026;
                -0.083856579723117;
                -0.54402111088937;
                ];
snes_uh(:, 14) = [0.0542778292757285;
                0.535359537516877;
                0.870198841456098;
                1.01016294988544;
                0.934901456950774;
                0.639253956618892;
                0.172881674752225;
                -0.337236309171933;
                -0.736320008639762;
                -0.955181918252052;
                -0.951120268472025;
                -0.700405828811966;
                -0.257574576943799;
                0.240583811287853;
                0.661229187201715;
                0.936661344029121;
                0.997340483440855;
                0.803104035426351;
                0.404923094891995;
                -0.0838565824060484;
                -0.54402111088937;
                ];
snes_uh(:, 15) = [0.0542778251813985;
                0.535359545924061;
                0.870198842509909;
                1.01016293424814;
                0.934901458018462;
                0.639253959982592;
                0.17288166986823;
                -0.337236311257362;
                -0.73632000744958;
                -0.955181917826336;
                -0.951120267934783;
                -0.700405827591886;
                -0.257574581698684;
                0.240583808297976;
                0.661229188027233;
                0.936661344593339;
                0.997340482666469;
                0.803104036148429;
                0.404923104528694;
                -0.08385658339499;
                -0.54402111088937;
                ];
snes_uh(:, 16) = [0.054277823850643;
                0.535359548415333;
                0.870198843045912;
                1.01016293940349;
                0.934901458409888;
                0.639253960994444;
                0.172881668379268;
                -0.337236311557353;
                -0.736320007033934;
                -0.955181917542207;
                -0.951120267685465;
                -0.70040582717447;
                -0.257574583177236;
                0.240583807399086;
                0.661229188313562;
                0.936661344670393;
                0.997340483037134;
                0.803104036386849;
                0.404923107696448;
                -0.083856583779691;
                -0.54402111088937;
                ];
snes_uh(:, 17) = [0.0542778234175923;
                0.535359549045518;
                0.870198843136247;
                1.01016293798646;
                0.93490145850447;
                0.639253961268247;
                0.172881667969042;
                -0.337236311518753;
                -0.736320006909749;
                -0.955181917486766;
                -0.951120267623107;
                -0.700405827047258;
                -0.257574583585729;
                0.240583807164994;
                0.661229188404046;
                0.936661344725832;
                0.997340483003231;
                0.803104036466418;
                0.404923108645765;
                -0.0838565839154135;
                -0.54402111088937;
                ];

% plot the solution
figure;
X_h = omega_l: hh/pp :omega_r;
for i=1:counter
    Y_h = snes_uh(:,i);
    h_fem = plot(X_h, Y_h,'b-', 'LineWidth', 2);
    hold on;
end
X = omega_l:0.01:omega_r;
Y = exact(X);
h_exact = plot(X, Y,'r--', 'LineWidth', 2);

legend([h_fem, h_exact], {'FEM', 'EXACT'}, 'Location', 'Best', 'FontSize', 14, 'Box', 'on');
xlabel("X");
ylabel("Temperature");


snes_error = zeros(17, 1);

snes_error(1,:) = 2.900846405359e+00;
snes_error(2,:) = 3.371646644088e+00;
snes_error(3,:) = 1.285728166297e+00;
snes_error(4,:) = 1.185190627559e-01;
snes_error(5,:) = 6.713001820818e-02;
snes_error(6,:) = 9.766007865165e-03;
snes_error(7,:) = 2.389165776499e-03;
snes_error(8,:) = 4.662109729464e-04;
snes_error(9,:) = 1.415896012975e-04;
snes_error(10,:) = 3.325746288732e-05;
snes_error(11,:) = 1.052389435956e-05;
snes_error(12,:) = 2.639871181160e-06;
snes_error(13,:) = 8.485851839162e-07;
snes_error(14,:) = 2.257956185306e-07;
snes_error(15,:) = 7.352304467622e-08;
snes_error(16,:) = 2.059347030351e-08;
snes_error(17,:) = 6.780048227806e-09;

log_error = log(error_set);
figure;
plot(log_error(1:counter-1), log_error(2:counter),'b-', 'LineWidth', 2);

snes_log_error = log(snes_error);
hold on;
plot(snes_log_error(1:counter-1), snes_log_error(2:counter),'r--', 'LineWidth', 2);
xlabel("ln(r_{i})");
ylabel("ln(r_{i+1})");

legend('Matlab','PetscSNES','Location', 'Best', 'FontSize', 14, 'Box', 'on');

uh_error = snes_uh(:, 1:counter) - uh_set(:, 1:counter); 

uh_error_norm = zeros(counter, 1);
for i = 1:counter
    uh_error_norm(i) = norm(uh_error(:,i));
end

