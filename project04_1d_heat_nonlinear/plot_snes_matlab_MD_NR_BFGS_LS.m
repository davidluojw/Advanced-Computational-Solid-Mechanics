snes_uh = zeros(21, 21);

snes_uh(:,1) = [0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                -0.54402111088937;
                ];

snes_uh(:, 2) = [0.0469949278790754;
                 0.57501104145373;
                 1.08057529775141;
                 1.3479061750176;
                 1.19767401011823;
                 0.715239713568341;
                 0.167463772260764;
                 -0.353022301177344;
                 -0.875284309963495;
                 -1.2541969406547;
                 -1.24263291106098;
                 -0.819175896179746;
                 -0.270823780105879;
                 0.234746862947046;
                 0.749431277873764;
                 1.20386942379745;
                 1.31813268224586;
                 0.96681092762493;
                 0.419903037643202;
                 -0.0847367177318517;
                 -0.54402111088937;
                ];
snes_uh(:, 3) = [0.0563692519706301;
                0.59439918558514;
                0.909546633867779;
                0.927057011622213;
                0.937738144242128;
                0.711611197919666;
                0.18885864586435;
                -0.371743605614593;
                -0.805320638297031;
                -0.92448747558151;
                -0.934051316124842;
                -0.776929865832063;
                -0.289969577781414;
                0.257595255294098;
                0.731895353663496;
                0.933667186856945;
                0.943723751266362;
                0.868855176947681;
                0.44987310276374;
                -0.0924721417198069;
                -0.54402111088937;
                ];

snes_uh(:, 4) = [0.0570140869732605;
                0.509272127321972;
                0.774585057829312;
                0.919437488557945;
                0.832706183514683;
                0.592091088365751;
                0.171047914572408;
                -0.322398213712049;
                -0.658633457923558;
                -0.848230045368472;
                -0.839914903043684;
                -0.626753930114223;
                -0.243548021914867;
                0.239045164436875;
                0.611252417255368;
                0.83522242633528;
                0.898255175805313;
                0.714258677074115;
                0.390810382344431;
                -0.0815713846291429;
                -0.54402111088937;
                ];

snes_uh(:, 5) = [0.0535382664084183;
                0.516279374224837;
                0.862111237129242;
                1.01931205832913;
                0.935813025854209;
                0.617147316075725;
                0.168599348254581;
                -0.326476731480904;
                -0.717989682623251;
                -0.963091261948607;
                -0.958016194264162;
                -0.679661408243389;
                -0.248381346245566;
                0.234865118164963;
                0.63900306669614;
                0.937608764464373;
                1.0051054655885;
                0.787092779589991;
                0.39108334343681;
                -0.0812539195200211;
                -0.54402111088937;
                ];

snes_uh(:, 6) = [0.0539262274036436;
                0.540034318378022;
                0.884132798072367;
                1.02919868012854;
                0.949229448691262;
                0.647293982511527;
                0.173250548783563;
                -0.339647007709947;
                -0.748781177621457;
                -0.969899738257096;
                -0.965611537634853;
                -0.712116494947153;
                -0.25995834729565;
                0.240815513515387;
                0.670212083310564;
                0.951491891041606;
                1.01458968512533;
                0.816345363345116;
                0.407344449593176;
                -0.0842382832480565;
                -0.54402111088937;
                ];

snes_uh(:, 7) = [0.054427379894398;
                0.538616894179855;
                0.870629581662897;
                1.00357629652982;
                0.934457326960432;
                0.642584573873647;
                0.173644649383997;
                -0.339180359073725;
                -0.738251238043159;
                -0.954018924406831;
                -0.950423453327583;
                -0.702798329028644;
                -0.259064757851785;
                0.241771773516405;
                0.664445067769426;
                0.935950524588132;
                0.993595612484602;
                0.804738984925043;
                0.40746106755959;
                -0.0843403185132485;
                -0.54402111088937;
                ];
snes_uh(:, 8) = [0.0543768011496795;
                0.535141466396475;
                0.868608228507486;
                1.00844100227147;
                0.932575520799562;
                0.638679923308806;
                0.172986129580912;
                -0.33710817513506;
                -0.735127101511355;
                -0.952075846796512;
                -0.9481564186386;
                -0.699432350657903;
                -0.257488554882823;
                0.240658838225915;
                0.660428890285817;
                0.934174486671331;
                0.994736459680261;
                0.801851375209516;
                0.404901056199202;
                -0.0838649116759441;
                -0.54402111088937;
                ];
snes_uh(:, 9) = [0.0542822305465595;
                0.53495761103488;
                0.869534406913573;
                1.00968399934638;
                0.934366389733503;
                0.638725552243411;
                0.17281359759061;
                -0.337014888620796;
                -0.73573765487196;
                -0.954894347244371;
                -0.950699164126142;
                -0.699793033960614;
                -0.257378414395545;
                0.240500232030005;
                0.660724210807893;
                0.936227274081173;
                0.997070042907538;
                0.802430754156437;
                0.404656166384709;
                -0.0838086428681469;
                -0.54402111088937;
                ];
snes_uh(:, 10) = [0.054265875834867;
                0.535335167096914;
                0.870408625012693;
                1.01056204697957;
                0.935148420798869;
                0.63925141679696;
                0.172861940399084;
                -0.337222527692435;
                -0.736372013081874;
                -0.955326289882768;
                -0.951357745296172;
                -0.700449864069148;
                -0.257565459620969;
                0.240557838268011;
                0.661219829929736;
                0.936829963804774;
                0.997478312305824;
                0.80321731113677;
                0.404892913358247;
                -0.0838498204807334;
                -0.54402111088937;
                ];
snes_uh(:, 11) = [0.0542763862124974;
                0.535426297107608;
                0.870320068939841;
                1.01023961958603;
                0.935003606633918;
                0.639353645763152;
                0.172892424036259;
                -0.337270458987112;
                -0.736450273359967;
                -0.955323816752515;
                -0.951222249478208;
                -0.70053347634883;
                -0.257606351932775;
                0.240595013247194;
                0.661331296642964;
                0.936792842247448;
                0.997523097745323;
                0.803243103484266;
                0.404963587691236;
                -0.0838635985624758;
                -0.54402111088937;
                ];
snes_uh(:, 12) = [0.0542799055883629;
                0.535371476206227;
                0.870164967477752;
                1.01010533354806;
                0.934874145639813;
                0.639261088625385;
                0.172885733763103;
                -0.337244352767245;
                -0.73631488953067;
                -0.955147340605126;
                -0.951100182356278;
                -0.700402262165687;
                -0.257579905495531;
                0.240590932874101;
                0.661240287397021;
                0.936631702435875;
                0.997263409560926;
                0.803083106047395;
                0.404934392587046;
                -0.0838588823058013;
                -0.54402111088937;
                ];
snes_uh(:, 13) = [0.0542792921162033;
                0.535364824290768;
                0.870195995233168;
                1.0101658696197;
                0.934900917010456;
                0.639256845789059;
                0.172884203948759;
                -0.337239786293394;
                -0.736318563563721;
                -0.955180811085179;
                -0.951118828121408;
                -0.700404201021538;
                -0.257576428942651;
                0.240587996072708;
                0.661232976044534;
                0.936659968480684;
                0.997341139398387;
                0.803100343243795;
                0.404928205911993;
                -0.0838576897150242;
                -0.54402111088937;
                ];
snes_uh(:, 14) = [0.0542784186772475;
                0.535360536252739;
                0.870200260246914;
                1.01016345600694;
                0.934902504908224;
                0.639254386756074;
                0.172882727297935;
                -0.337237181852386;
                -0.736319996571865;
                -0.955182825624262;
                -0.951120935312117;
                -0.700405747167436;
                -0.257575045232039;
                0.240585244747798;
                0.66122934270237;
                0.936662439805838;
                0.997342010477548;
                0.803104881991931;
                0.404924435942498;
                -0.0838569150793771;
                -0.54402111088937;
                ];
snes_uh(:, 15) = [0.0542778751820658;
                0.53535913181154;
                0.870198315906987;
                1.01016297891921;
                0.934900935063381;
                0.63925374467483;
                0.172881687741733;
                -0.337236060412508;
                -0.736320042345274;
                -0.955181377698292;
                -0.951119869100806;
                -0.700405921879252;
                -0.257574456848854;
                0.240583724378035;
                0.661228965308596;
                0.936660793014611;
                0.997339757457446;
                0.803103930120134;
                0.404922785561598;
                -0.0838565290048697;
                -0.54402111088937;
                ];
snes_uh(:, 16) = [0.0542778003394919;
                0.535359487632703;
                0.870198695806942;
                1.01016271848173;
                0.934901430611023;
                0.639253946419258;
                0.172881612940523;
                -0.33723626007178;
                -0.73631999195951;
                -0.955181949126992;
                -0.951120283790725;
                -0.700405802831455;
                -0.257574546601389;
                0.240583749065016;
                0.661229251900564;
                0.936661335235419;
                0.997340453116711;
                0.803103870040467;
                0.404923019108757;
                -0.0838565622903567;
                -0.54402111088937;
                ];
snes_uh(:, 17) = [0.054277818420177;
                0.535359591887778;
                0.870198959236802;
                1.01016306373693;
                0.934901510534434;
                0.639253979205502;
                0.172881668714971;
                -0.337236343214628;
                -0.73632001400462;
                -0.955181939619376;
                -0.951120296164785;
                -0.700405833118417;
                -0.257574603747433;
                0.24058381639521;
                0.661229183181523;
                0.936661386600203;
                0.997340526636368;
                0.803104115082625;
                0.4049231459448;
                -0.0838565905681723;
                -0.54402111088937;
                ];
snes_uh(:, 18) = [0.0542778256124463;
                0.535359550302604;
                0.870198835284212;
                1.01016292645403;
                0.934901450984361;
                0.639253960409621;
                0.172881671635234;
                -0.337236311763692;
                -0.736320006885037;
                -0.955181910912498;
                -0.951120256561151;
                -0.700405828658905;
                -0.257574584687908;
                0.240583809697511;
                0.661229179579308;
                0.936661338007258;
                0.997340491228378;
                0.803104043249639;
                0.404923112445249;
                -0.0838565849536512;
                -0.54402111088937;
                ];
snes_uh(:, 19) = [0.0542778240374469;
                0.535359547765369;
                0.870198837305646;
                1.01016293349032;
                0.934901456336922;
                0.639253960422015;
                0.172881668810632;
                -0.337236310263311;
                -0.736320006530941;
                -0.955181916868507;
                -0.951120266951293;
                -0.700405826749466;
                -0.257574583078711;
                0.240583807673332;
                0.661229187570896;
                0.93666134346376;
                0.997340479890921;
                0.803104033130441;
                0.404923108570001;
                -0.0838565840110558;
                -0.54402111088937;
                ];
snes_uh(:, 20) = [0.0542778228778316;
                0.535359549179378;
                0.8701988446914;
                1.01016293926424;
                0.934901458959295;
                0.639253961533953;
                0.17288166738408;
                -0.337236311417748;
                -0.736320006892827;
                -0.955181917234037;
                -0.95112026772446;
                -0.700405826945206;
                -0.257574583734967;
                0.240583806765935;
                0.661229189477741;
                0.936661344542222;
                0.997340483199472;
                0.80310403639374;
                0.404923108765853;
                -0.0838565838993837;
                -0.54402111088937;
                ];
snes_uh(:, 21) = [0.0542778231766765;
                0.535359549477776;
                0.87019884330057;
                1.01016293855199;
                0.934901458641712;
                0.639253961462025;
                0.172881667755795;
                -0.337236311499271;
                -0.736320006860146;
                -0.955181917651323;
                -0.951120267588765;
                -0.700405827004795;
                -0.257574583793502;
                0.240583807069856;
                0.66122918834449;
                0.936661345027635;
                0.997340483380198;
                0.803104036914394;
                0.404923109163037;
                -0.0838565839993247;
                -0.54402111088937;
                ];

snes_counter = 21;

% plot the solution
figure;
X_h = omega_l: hh/pp :omega_r;
for i=1:snes_counter
    Y_h = snes_uh(:,i);
    h_fem = plot(X_h, Y_h,'b-', 'LineWidth', 2);
    hold on;
end
X = omega_l:0.01:omega_r;
Y = exact(X);
h_exact = plot(X, Y,'r--', 'LineWidth', 2);

legend([h_fem, h_exact], {'FEM', 'EXACT'}, 'Location', 'Best', 'FontSize', 14, 'Box', 'on');
xlabel("X");
ylabel("Temperature");


snes_error = zeros(21, 1);

snes_error(1,:) = 2.900846405359e+00;
snes_error(2,:) = 3.371646644088e+00;
snes_error(3,:) = 2.070487387799e+00;
snes_error(4,:) = 7.612242717596e-01;
snes_error(5,:) = 4.354529841201e-01;
snes_error(6,:) = 1.178548996397e-01;
snes_error(7,:) = 1.053908665063e-01;
snes_error(8,:) = 2.617566392502e-02;
snes_error(9,:) = 6.856500929806e-03;
snes_error(10,:) = 3.447817892275e-03;
snes_error(11,:) = 1.192487938820e-03;
snes_error(12,:) = 7.636915401335e-04;
snes_error(13,:) = 1.401543717433e-04;
snes_error(14,:) = 2.553745166944e-05;
snes_error(15,:) = 1.208501226549e-05;
snes_error(16,:) = 2.518124305625e-06;
snes_error(17,:) = 9.338409611449e-07;
snes_error(18,:) = 1.776675156721e-07;
snes_error(19,:) = 3.542673990871e-08;
snes_error(20,:) = 1.785327724712e-08;
snes_error(21,:) = 4.431301191395e-09;



log_error = log(error_set);
figure;
plot(log_error(1:counter-1), log_error(2:counter),'b-', 'LineWidth', 2);

snes_log_error = log(snes_error);
hold on;
plot(snes_log_error(1:snes_counter-1), snes_log_error(2:snes_counter),'r--', 'LineWidth', 2);
xlabel("ln(r_{i})");
ylabel("ln(r_{i+1})");

legend('Matlab','PetscSNES','Location', 'Best', 'FontSize', 14, 'Box', 'on');

uh_error = snes_uh(:, 1:snes_counter) - uh_set(:, 1:snes_counter); 

uh_error_norm = zeros(snes_counter, 1);
for i = 1:snes_counter
    uh_error_norm(i) = norm(uh_error(:,i));
end

