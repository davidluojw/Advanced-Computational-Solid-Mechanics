snes_uh = zeros(21, 16);

snes_uh(:,1) = [0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                0;
                -0.54402111088937;
                ];

snes_uh(:, 2) = [0.0469949278790754;
                 0.57501104145373;
                 1.08057529775141;
                 1.3479061750176;
                 1.19767401011823;
                 0.715239713568341;
                 0.167463772260764;
                 -0.353022301177344;
                 -0.875284309963495;
                 -1.2541969406547;
                 -1.24263291106098;
                 -0.819175896179746;
                 -0.270823780105879;
                 0.234746862947046;
                 0.749431277873764;
                 1.20386942379745;
                 1.31813268224586;
                 0.96681092762493;
                 0.419903037643202;
                 -0.0847367177318517;
                 -0.54402111088937;
                ];
snes_uh(:, 3) = [0.0541061659770842;
                0.519787916107911;
                0.667203637872477;
                0.522605270729807;
                0.634489250394494;
                0.605145931044892;
                0.174881893637772;
                -0.329293248021946;
                -0.642776059023635;
                -0.578617492658005;
                -0.600274773929069;
                -0.636242087777425;
                -0.259758367303823;
                0.234486827327542;
                0.613579533283295;
                0.624457556633925;
                0.566491458119046;
                0.6791350587406;
                0.403172030928524;
                -0.0838785415552714;
                -0.54402111088937;
                ];

snes_uh(:, 4) = [0.0538805737829832;
                0.540080233643445;
                0.995409757441155;
                1.31070302302445;
                1.1261301203571;
                0.648079672299458;
                0.171072093246783;
                -0.341887618437339;
                -0.78467346081751;
                -1.18713957425715;
                -1.16841166720161;
                -0.722906442478123;
                -0.256422792707551;
                0.243094032930177;
                0.682276535999598;
                1.13230268046109;
                1.26735517515148;
                0.864365471002565;
                0.40513830260456;
                -0.0838472472938837;
                -0.54402111088937;
                ];

snes_uh(:, 5) = [0.0518889675616113;
                0.528593832666829;
                0.756857042943831;
                0.580729504328923;
                0.730307940911039;
                0.633142291009178;
                0.174469862551772;
                -0.333828224350113;
                -0.706087908463855;
                -0.679257818580899;
                -0.710345325890312;
                -0.693337659411528;
                -0.264571121566581;
                0.232928199750307;
                0.644576587893569;
                0.720193724623756;
                0.64705689720191;
                0.760376366180479;
                0.404895569682657;
                -0.0838581098260153;
                -0.54402111088937;
                ];

snes_uh(:, 6) = [0.0562250037022023;
                0.540325040048484;
                0.950169254343623;
                1.29047486033565;
                1.08163598249336;
                0.63947095981235;
                0.171420766368887;
                -0.339749793333645;
                -0.754025282509835;
                -1.14561795935498;
                -1.1192400678202;
                -0.695514766524537;
                -0.252337966644967;
                0.246050434377716;
                0.673219141304414;
                1.09117667247003;
                1.24089215700445;
                0.820456221502331;
                0.404926679803501;
                -0.0838563702635241;
                -0.54402111088937;
                ];

snes_uh(:, 7) = [0.0521620170792536;
                0.530163999483503;
                0.800404870744794;
                0.612095053574435;
                0.786037933977705;
                0.639078384014337;
                0.175895962464669;
                -0.333538510766049;
                -0.72323706388071;
                -0.735083535155054;
                -0.773219539516;
                -0.705538767857005;
                -0.263374857946541;
                0.234583555230956;
                0.650339640922593;
                0.77327255342044;
                0.68837177404409;
                0.789722220378263;
                0.404922643766326;
                -0.0838566125993913;
                -0.54402111088937;
                ];
snes_uh(:, 8) = [0.0575650663128355;
                0.540939745582647;
                0.923855459079534;
                1.27754771307584;
                1.04978461681799;
                0.639300289245212;
                0.172867184261628;
                -0.337835007458435;
                -0.743397498253601;
                -1.1159678616003;
                -1.08275706331692;
                -0.68962305064339;
                -0.251008296977605;
                0.247255433591726;
                0.672157759005923;
                1.06172463700512;
                1.22399730632135;
                0.802775788543807;
                0.404923169845516;
                -0.0838565802239974;
                -0.54402111088937;
                ];
snes_uh(:, 9) = [0.0521580705966353;
                0.530675458342298;
                0.823933804555222;
                0.631280074961266;
                0.822965153217775;
                0.640551656311814;
                0.176365572148916;
                -0.333507574613636;
                -0.728842297761554;
                -0.773023718720676;
                -0.816215244911722;
                -0.707661804395546;
                -0.262071399315221;
                0.235970109787795;
                0.652238020703495;
                0.809179085939708;
                0.714081448775661;
                0.800847145194889;
                0.404923101158855;
                -0.0838565844881626;
                -0.54402111088937;
                ];
snes_uh(:, 10) = [0.0580883213001309;
                0.541064295982909;
                0.908211972449451;
                1.26877602884952;
                1.0259515989775;
                0.640140012909645;
                0.173998932754713;
                -0.336540903585429;
                -0.739183668024922;
                -1.09317544821519;
                -1.05433245840407;
                -0.689182665386558;
                -0.250785555441023;
                0.247477196680371;
                0.671658524815745;
                1.03839787351406;
                1.21191394529446;
                0.796251199705799;
                0.404923110132251;
                -0.0838565839293361;
                -0.54402111088937;
                ];
snes_uh(:, 11) = [0.0520164300086904;
                0.530858728664689;
                0.837216829035197;
                0.64377598868579;
                0.848826802531572;
                0.640712186253412;
                0.176213999050623;
                -0.333858579699074;
                -0.731331201169095;
                -0.80136518795046;
                -0.848040389017031;
                -0.707574213073505;
                -0.261165925915725;
                0.236900751464956;
                0.65339334924617;
                0.836047835281668;
                0.732009641462899;
                0.805009644977698;
                0.404923108959689;
                -0.0838565840024405;
                -0.54402111088937;
                ];
snes_uh(:, 12) = [0.0581327490871196;
                0.540883691632944;
                0.898744931898153;
                1.26257275831159;
                1.00779731661694;
                0.640886676519218;
                0.174712545758933;
                -0.335735901233998;
                -0.737107120386676;
                -1.07484160849126;
                -1.03155004598018;
                -0.689918927094654;
                -0.250995321814243;
                0.247270434729686;
                0.671015242296957;
                1.01900474040663;
                1.20267124382576;
                0.794171677828515;
                0.404923109112921;
                -0.0838565839928833;
                -0.54402111088937;
                ];
snes_uh(:, 13) = [0.0519017524929104;
                0.5309938432324;
                0.845019617232448;
                0.652388558976278;
                0.867548321605709;
                0.640476007895531;
                0.175839955402937;
                -0.334338451018107;
                -0.732839156278495;
                -0.823616550452231;
                -0.872544934294297;
                -0.707053523931544;
                -0.260533312286293;
                0.237548078264228;
                0.654309108833054;
                0.857319642014579;
                0.745461208521981;
                0.806479340416689;
                0.404923109092896;
                -0.0838565839941325;
                -0.54402111088937;
                ];
snes_uh(:, 14) = [0.0579551257410876;
                0.540558668879908;
                0.892852161085589;
                1.25803470131952;
                0.993847637350806;
                0.641414954957939;
                0.175138129577322;
                -0.335240922392958;
                -0.735865653408012;
                -1.05966711235458;
                -1.01299975106383;
                -0.690814859412328;
                -0.251358177801457;
                0.246905430623445;
                0.670299932286159;
                1.00246512831522;
                1.19529246484852;
                0.793766805147694;
                0.404923109095514;
                -0.0838565839939687;
                -0.54402111088937;
                ];
snes_uh(:, 15) = [0.0518288943564214;
                0.531127689245195;
                0.84979327774573;
                0.658592142804569;
                0.881374348242074;
                0.640134855333406;
                0.175413176953277;
                -0.334828559735118;
                -0.733940218836852;
                -0.841636102135678;
                -0.891835540453886;
                -0.706495634277939;
                -0.260071693018017;
                0.238021209454303;
                0.655074677726918;
                0.874716977525807;
                0.756049935483147;
                0.806919615472547;
                0.404923109095171;
                -0.0838565839939903;
                -0.54402111088937;
                ];
snes_uh(:, 16) = [0.0576981839127751;
                0.540196335958704;
                0.889053715424459;
                1.25463031720455;
                0.983089530470179;
                0.641769719898001;
                0.175385806097249;
                -0.334935011568296;
                -0.735027528763376;
                -1.04686105122963;
                -0.997770958201432;
                -0.691645331622595;
                -0.251760011416595;
                0.246498487608045;
                0.669596822961389;
                0.988165299038035;
                1.18922921883776;
                0.793944343656931;
                0.404923109095216;
                -0.0838565839939876;
                -0.54402111088937;
                ];

% plot the solution
figure;
X_h = omega_l: hh/pp :omega_r;
for i=1:counter
    Y_h = snes_uh(:,i);
    h_fem = plot(X_h, Y_h,'b-', 'LineWidth', 2);
    hold on;
end
X = omega_l:0.01:omega_r;
Y = exact(X);
h_exact = plot(X, Y,'r--', 'LineWidth', 2);

legend([h_fem, h_exact], {'FEM', 'EXACT'}, 'Location', 'Best', 'FontSize', 14, 'Box', 'on');
xlabel("X");
ylabel("Temperature");


snes_error = zeros(16, 1);

snes_error(1,:) = 2.900846405359e+00;
snes_error(2,:) = 3.371646644088e+00;
snes_error(3,:) = 3.808321920574e+00;
snes_error(4,:) = 3.871284466854e+00;
snes_error(5,:) = 4.018088287367e+00;
snes_error(6,:) = 4.005707987749e+00;
snes_error(7,:) = 4.063662462991e+00;
snes_error(8,:) = 4.047295280364e+00;
snes_error(9,:) = 4.079635786514e+00;
snes_error(10,:) = 4.070803337390e+00;
snes_error(11,:) = 4.095516968901e+00;
snes_error(12,:) = 4.093090637304e+00;
snes_error(13,:) = 4.114998358160e+00;
snes_error(14,:) = 4.116498878424e+00;
snes_error(15,:) = 4.136663896534e+00;
snes_error(16,:) = 4.140165121064e+00;

log_error = log(error_set);
figure;
plot(log_error(1:counter-1), log_error(2:counter),'b-', 'LineWidth', 2);

snes_log_error = log(snes_error);
hold on;
plot(snes_log_error(1:counter-1), snes_log_error(2:counter),'r--', 'LineWidth', 2);
xlabel("ln(r_{i})");
ylabel("ln(r_{i+1})");

legend('Matlab','PetscSNES','Location', 'Best', 'FontSize', 14, 'Box', 'on');

uh_error = snes_uh(:, 1:counter) - uh_set(:, 1:counter); 

uh_error_norm = zeros(counter, 1);
for i = 1:counter
    uh_error_norm(i) = norm(uh_error(:,i));
end

